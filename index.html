<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Work Order Dashboard</title>
<style>
  #viewDiv {
    height: 400px;
    width: 100%;
  }
</style>
<link rel="stylesheet" href="https://js.arcgis.com/4.24/esri/themes/light/main.css">
<script src="https://js.arcgis.com/4.24/"></script>
</head>
<body>
<div id="viewDiv"></div>

<script>
require([
  "esri/Map",
  "esri/views/MapView",
  "esri/layers/FeatureLayer",
  "esri/widgets/Editor",
  "esri/identity/OAuthInfo",
  "esri/identity/IdentityManager",
  "esri/layers/support/FeatureFilter"
], function(Map, MapView, FeatureLayer, Editor, OAuthInfo, IdentityManager, FeatureFilter) {
// Setup OAuthInfo to define OAuth details
            var info = new OAuthInfo({
                appId: "ti3fi1FqvHE2Hhyw", // Replace with your actual App ID
                popup: false // Optional: Set to false if you prefer OAuth in the same window
            });
            IdentityManager.registerOAuthInfos([info]);

            IdentityManager.checkSignInStatus(info.portalUrl).then(
                function() {
                    console.log("Signed in");
                    initApplication();
                }
            ).catch(
                function() {
                    console.log("Not signed in");
                    IdentityManager.getCredential(info.portalUrl);
                }
            );
  
  const map = new Map({
    basemap: "streets"
  });

  const view = new MapView({
    container: "viewDiv",
    map: map,
    center: [-94.805, 45.027],
    zoom: 13
  });

  
  
    const userInfo = IdentityManager.credentials[0].userId;
    
    const featureLayer = new FeatureLayer({
      url: "https://services6.arcgis.com/MU31z9HAakdc3W69/arcgis/rest/services/Requests_41a56ed49cbb4662927825495afe2ae8/FeatureServer/0",
      outFields: ["*"],
      popupTemplate: {
        title: "Work Order {WorkOrderID}",
        content: "Description: {Description}<br>Assigned To: {assignedto}"
      }
    });

    map.add(featureLayer);

    const featureFilter = new FeatureFilter({
      where: `assignedto = '${userInfo}'`
    });

    featureLayer.setFeatureFilter(featureFilter);

  // Create a function to display userInfo in a modal dialog
function displayUserInfoModal(userInfo) {
  // Create a modal dialog element
  var modal = document.createElement('div');
  modal.style.position = 'fixed';
  modal.style.top = '50%';
  modal.style.left = '50%';
  modal.style.transform = 'translate(-50%, -50%)';
  modal.style.backgroundColor = '#fff';
  modal.style.padding = '20px';
  modal.style.border = '1px solid #000';
  
  // Set the content of the modal dialog to the userInfo value
  modal.innerHTML = "<h2>User Information</h2><p>User ID: " + userInfo + "</p>";
  
  // Append the modal to the body of the document
  document.body.appendChild(modal);
}

// Call the function to display the userInfo in a modal dialog
displayUserInfoModal(userInfo);

});
</script>
</body>
</html>
