require([
    "esri/Map",
    "esri/views/MapView",
    "esri/Graphic",
    "esri/layers/GraphicsLayer",
    "esri/widgets/Locate",
    "esri/geometry/Point",
    "esri/symbols/PictureMarkerSymbol",
    "esri/layers/FeatureLayer",
    "esri/rest/support/Query"
], function(Map, MapView, Graphic, GraphicsLayer, Locate, Point, PictureMarkerSymbol, FeatureLayer, Query) {
    var map = new Map({
        basemap: "streets-navigation-vector"
    });

    var view = new MapView({
        container: "viewDiv",
        map: map,
        center: [-93.2650, 44.9778], // Center on Minneapolis
        zoom: 12
    });

    var graphicsLayer = new GraphicsLayer();
    map.add(graphicsLayer);

    var locateWidget = new Locate({
        view: view,
        rotationEnabled: false // Correct property for disabling map rotation
    });

    view.ui.add(locateWidget, "top-left");

    view.when().then(function() {
        locateWidget.locate().catch(function(error) {
            console.error("Locate widget error:", error.message);
            // Optionally handle the error, e.g., display a message to the user
        });
        
        // Define the FeatureLayer with the correct URL
        var featureLayer = new FeatureLayer({
            url: "https://gis.minneapolisparks.org/arcgisprod/rest/services/Services/MPRB_PublicLayers/MapServer/0"
        });

        view.on("click", function(event) {
            // Display a graphic at the clicked location using a custom image
            var pointGraphic = new Graphic({
                geometry: event.mapPoint,
                symbol: new PictureMarkerSymbol({
                    url: "https://i.ibb.co/j6ZWfnW/map-location-marker.png",
                    width: "36px",
                    height: "36px"
                })
            });
            graphicsLayer.removeAll();
            graphicsLayer.add(pointGraphic);

            // Query the feature layer
            var query = featureLayer.createQuery();
            query.geometry = event.mapPoint; // Use the point directly
            query.spatialRelationship = "intersects";
            query.outFields = ["*"];
            query.returnGeometry = true;

            featureLayer.queryFeatures(query).then(function(result) {
                console.log("Query results:", result);
                if (result.features.length > 0) {
                    enableCell('cell2'); // Enable cell 2 when location is selected
                } else {
                    alert("Location is not within MPRB's Responsibility");
                }
            }).catch(function(error) {
                console.error("Error querying features:", error);
            });
            
            enableCell('cell1'); // Enable cell 1 when location is selected
        });
    });
    
    var currentCellIndex = 1; // Variable to track the current active cell index

    function enableCell(cellIndex) {
        // Check if the current cell index is less than or equal to the clicked cell index
        if (cellIndex <= currentCellIndex) {
            // Get the clicked cell
            var clickedCell = document.getElementById('cell' + cellIndex);

            // Check if the previous cell is completed
            var prevCell = document.getElementById('cell' + (cellIndex - 1));
            if (!prevCell.classList.contains('disabled')) {
                // Enable the clicked cell
                clickedCell.classList.remove('disabled');
                clickedCell.style.backgroundColor = '#f0f0f0'; // Set background color to gray
                clickedCell.style.border = '1px solid #ddd'; // Reset border to light gray

                // Disable the previous cell
                prevCell.style.backgroundColor = '#f0f0f0'; // Set background color to gray
                prevCell.style.border = '1px solid #ddd'; // Reset border to light gray

                // Update the current cell index
                currentCellIndex = cellIndex;

                // Enable next cell
                if (currentCellIndex < 4) {
                    var nextCell = document.getElementById('cell' + (currentCellIndex + 1));
                    nextCell.classList.remove('disabled');
                    nextCell.style.backgroundColor = '#fff';
                    nextCell.style.border = '1px solid #333';
                }
            }
        }
    }
});
</script>

    <script>
require([
    "esri/Map",
    "esri/views/MapView",
    "esri/Graphic",
    "esri/layers/GraphicsLayer",
    "esri/widgets/Locate",
    "esri/geometry/Point",
    "esri/symbols/PictureMarkerSymbol",
    "esri/layers/FeatureLayer",
    "esri/rest/support/Query"
], function(Map, MapView, Graphic, GraphicsLayer, Locate, Point, PictureMarkerSymbol, FeatureLayer, Query) {
    var map = new Map({
        basemap: "streets-navigation-vector"
    });

    var view = new MapView({
        container: "viewDiv",
        map: map,
        center: [-93.2650, 44.9778], // Center on Minneapolis
        zoom: 12
    });

    var graphicsLayer = new GraphicsLayer();
    map.add(graphicsLayer);

    var locateWidget = new Locate({
        view: view,
        rotationEnabled: false // Correct property for disabling map rotation
    });

    view.ui.add(locateWidget, "top-left");

    view.when().then(function() {
        locateWidget.locate().catch(function(error) {
            console.error("Locate widget error:", error.message);
            // Optionally handle the error, e.g., display a message to the user
        });
        
        // Define the FeatureLayer with the correct URL
        var featureLayer = new FeatureLayer({
            url: "https://gis.minneapolisparks.org/arcgisprod/rest/services/Services/MPRB_PublicLayers/MapServer/0"
        });

        view.on("click", function(event) {
            // Display a graphic at the clicked location using a custom image
            var pointGraphic = new Graphic({
                geometry: event.mapPoint,
                symbol: new PictureMarkerSymbol({
                    url: "https://i.ibb.co/j6ZWfnW/map-location-marker.png",
                    width: "36px",
                    height: "36px"
                })
            });
            graphicsLayer.removeAll();
            graphicsLayer.add(pointGraphic);

            // Query the feature layer
            var query = featureLayer.createQuery();
            query.geometry = event.mapPoint; // Use the point directly
            query.spatialRelationship = "intersects";
            query.outFields = ["*"];
            query.returnGeometry = true;

            featureLayer.queryFeatures(query).then(function(result) {
                console.log("Query results:", result);
                if (result.features.length > 0) {
                    enableCell('cell2'); // Enable cell 2 when location is selected
                } else {
                    alert("Location is not within MPRB's Responsibility");
                }
            }).catch(function(error) {
                console.error("Error querying features:", error);
            });
        });
    });
});
</script>
</body>
</html>
